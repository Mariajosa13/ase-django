{% extends 'base.html' %}
{% load static %}

{% block content %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/cart_checkout.css' %}">
{% endblock %}

<div class="checkout-container">
    <h1 class="checkout-title">Proceder al Pago</h1>

    {% if cart_items %}
        <div class="checkout-row">
            <div class="main-content">
                <div class="order-summary-card">
                    <div class="card-header">
                        <h5>Resumen de tu Pedido</h5>
                    </div>
                    <div class="card-body">
                        <ul class="order-items">
                            {% for item in cart_items %}
                                <li class="order-item">
                                    <div class="item-info">
                                        <h6>{{ item.producto.nombre }}</h6>
                                        <small>{{ item.quantity }} x ${{ item.producto.precio|floatformat:2 }}</small>
                                    </div>
                                    <span class="item-total">${{ item.get_total_price|floatformat:2 }}</span>
                                </li>
                            {% endfor %}
                            <li class="order-item total-item">
                                <span>Total del Carrito:</span>
                                <span class="total-price">${{ total_cart_price|floatformat:2 }}</span>
                            </li>
                        </ul>
                    </div>
                </div>

                {% comment %} 
                Aquí puedes agregar más secciones como:
                - Formulario para dirección de envío
                - Selección de método de envío
                - Formulario de pago (tarjeta de crédito, etc.)
                {% endcomment %}

                <h4 class="section-title">Información de Contacto</h4>
                {% if user.is_authenticated and user_profile %}
                    <div class="contact-info">
                        <p class="info-item"><strong>Nombre:</strong> {{ user_profile.nombre|default:"N/A" }} {{ user_profile.apellido|default:"N/A" }}</p>
                        <p class="info-item"><strong>Correo:</strong> {{ user_profile.correo|default:user.email }}</p>
                        {% if cliente_info %}
                            <p class="info-item"><strong>Celular:</strong> {{ cliente_info.celular|default:"N/A" }}</p>
                            <p class="info-item"><strong>Género:</strong> {{ cliente_info.get_genero_display }}</p>
                            <a href="{% url 'edit_profile' %}" class="btn btn-secondary">Editar Perfil</a>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="alert alert-info">
                        Por favor <a href="{% url 'signup' %}?next={{ request.path }}">inicia sesión</a> para agilizar tu compra, o continúa como invitado.
                    </div>
                {% endif %}

                <h4 class="section-title">Método de Pago</h4>
                <div class="alert alert-warning">
                    La integración de pasarelas de pago se realizaría en este paso. Por ahora, es un resumen.
                </div>

            </div>

            <div class="sidebar">
                <div class="summary-card">
                    <div class="summary-header">
                        <h5>Resumen del Pedido</h5>
                    </div>
                    <div class="summary-body">
                        <ul class="summary-items">
                            <li class="summary-item">
                                <span>Subtotal:</span>
                                <span>${{ total_cart_price|floatformat:2 }}</span>
                            </li>
                            <li class="summary-item">
                                <span>Envío:</span>
                                <span>$0.00</span>
                            </li>
                            <li class="summary-item total-summary">
                                <span>Total a Pagar:</span>
                                <span>${{ total_cart_price|floatformat:2 }}</span>
                            </li>
                        </ul>
                        <button type="submit" class="btn btn-primary btn-large">Confirmar Compra</button>
                        <a href="{% url 'view_cart' %}" class="btn btn-secondary btn-large">Volver al Carrito</a>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="empty-cart">
            Tu carrito está vacío. ¡No hay productos para proceder al pago!
            <br>
            <a href="{% url 'productos' %}" class="btn btn-primary">Ver Productos</a>
        </div>
    {% endif %}
</div>
{% endblock %}